<template>
    <template if:false={recordClicked}>
        <div class="datatable">
            <span class="datatable-header">
                <span class="narrow-column"> </span>
                <!-- Render column headers dynamically -->
                <template for:each={filteredDisplayObjectKeys} for:item="key">
                    <span key={key} class="slds-align_absolute-center">{key}</span>
                </template>
            </span>

            <ul class="datatable-body">
                <!-- Render rows based on filtered records and columns -->
                <template for:each={filteredRecords} for:item="record">
                    <li key={record.id}>  <!-- Use the record's ID as the key for each row -->
                        <span data-id={record.id} class="narrow-column">
                            <button
                                data-id={record.id}
                                class="slds-button slds-button_icon slds-m-right_x-small slds-align_absolute-center"
                                onclick={handleRecordSelection}>
                                <lightning-icon
                                    icon-name="utility:chevronright"
                                    alternative-text="Toggle"
                                    size="x-small">
                                </lightning-icon>
                            </button>
                        </span>

                        <!-- Display the values dynamically for each record -->
                        <template for:each={record.values} for:item="item">
                            <span key={item.key} class="row-item slds-align_absolute-center">
                                {item.value}
                            </span>
                        </template>
                    </li>
                </template>
            </ul>

            <template if:true={requireViewAll}>
                <footer>
                    <button class="slds-button slds-button_neutral slds-align_absolute-center" onclick={handleViewAll}>View All</button>
                </footer>
            </template>
        </div>
    </template>

    <template if:true={recordClicked}>
        <div class="datatable">
            <ul class="datatable-header">
                <li class="icon-header"> </li>
                <li>Id</li>
                <li>Name</li>
                <li>Email</li>
            </ul>
            <ul class="datatable-body">
                <li>
                    <span><button class="slds-button slds-button_icon slds-m-right_x-small" onclick={handleRecordCollapse}>
                        <lightning-icon icon-name="utility:chevrondown" alternative-text="Toggle" size="x-small"></lightning-icon>
                    </button></span>
                    <span>{selectedRecord.id}</span>
                    <span>{selectedRecord.name}</span>
                    <span>{selectedRecord.email}</span>
                </li>
            </ul>
            <c-related-object-main parentid={selectedRecord.id}></c-related-object-main>
        </div>
    </template>
</template>
